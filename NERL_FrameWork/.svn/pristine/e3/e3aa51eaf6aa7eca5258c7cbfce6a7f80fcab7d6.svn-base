package NERL;

import java.awt.List;
import java.io.IOException;
import java.net.MalformedURLException;
import java.util.concurrent.TimeUnit;

import library.Exceldataconfig;
import library.Utility;
import withdrawal_pkg.PledgeeRedemption_main;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.testng.Assert;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.DataProvider;
import org.testng.annotations.Test;
public class Benf_To_Benf_Main {
	private String part2;
	private static WebDriver driver;
	private Utility utility;
	public Exceldataconfig config;
	private final static Logger logger = LoggerFactory.getLogger(Benf_To_Benf_Main.class);
	@BeforeMethod()		
	public void Befour() throws InterruptedException, MalformedURLException {
		
		logger.info("Benf To Benf Test Cases Execution Started");
		
		System.setProperty("webdriver.chrome.driver", "D://chromedriver.exe");
		
		Thread.sleep(2000);
		
		/*TestFFonGrid Remote=new TestFFonGrid();
		driver=Remote.Grid();
	   */
		
		driver = new ChromeDriver();
		driver.get("https://nerltest.erepository.in/");
		driver.manage().window().maximize();
		 
		logger.info("Browser open Succesfully and Url is open");
		 utility = new Utility(driver);
}
    
	//++++++++++++++++++++++++EOT Initiation/Submit by RP Maker++++++++++++++++++++++++++++++++++++++++++++++++++

	@Test(priority=2,description="To verify if Rp Maker having Provision to initate/Submit EOT txn",dataProvider="Benf_To_Benf_Data")
    public void Benf_To_Benf_Submit(String WHCode,String Comm_ID,String From_Benf,String To_RP_ID,String To_Benf,String ENWR_Type,String ENWR_Number,String User_ID_1,String Passw_1,String User_ID_2,String Passw_2,String User_ID_3,String Passw_3,int Record_no) throws InterruptedException {
		logger.info("First Test Case Execution Started");
		//Login Wit RP Maker
		utility.Login(User_ID_1,Passw_1);
	
		driver.manage().timeouts().implicitlyWait(20, TimeUnit.SECONDS);
		
		// Click on Menu Icon
		driver.findElement(By.xpath(NERLConstants.Menu_Icon)).click();
		
		// Click on Menu Dropdown
		driver.findElement(By.xpath(NERLConstants.Menu_Dropdown)).click();
		
		// Click on Benf To Benf Menu Button
		driver.findElement(By.xpath(NERLConstants.Benf_To_Benf_Transfer))
				.click();
		// Click on Back Button
		Thread.sleep(2000);

		driver.findElement(By.xpath(NERLConstants.Back_Button)).click();
		Thread.sleep(2000);
		
		// Click on Popup (Warehouse Code)Button[...]
		driver.findElement(By.xpath(NERLConstants.Popup_Win_Button)).click();
		Thread.sleep(3000);

		// Send Text Into Search Text box on Popup Window (Warehouse List)
		driver.findElement(By.xpath(NERLConstants.Popup_Send_Txt)).sendKeys(WHCode);
		Thread.sleep(2000);

		// Select A 1st record From Popup Win
		driver.findElement(By.xpath(NERLConstants.Select_Record)).click();
		Thread.sleep(2000);
		// Click on Popup Button[...] Commodity ID
		driver.findElement(By.xpath(NERLConstants.Popup_Win_Button2)).click();
		Thread.sleep(3000);
		// Search Commodity ID
		driver.findElement(By.xpath(NERLConstants.Popup_Send_Txt2)).sendKeys(Comm_ID);
		Thread.sleep(2000);
		// Select Serched Commodity Record
		driver.findElement(By.xpath(NERLConstants.Select_Record2)).click();
		Thread.sleep(2000);

		// Click on From Beneficiary ID Button
		driver.findElement(By.xpath(NERLConstants.Popup_Win_Button3)).click();
		Thread.sleep(2000);
		driver.findElement(By.xpath(NERLConstants.Popup_Send_Txt3)).sendKeys(From_Benf);
		// Select First Record
		driver.findElement(By.xpath(NERLConstants.Select_Record3)).click();
		Thread.sleep(2000);
       
		// RP Send To Rp Id
		driver.findElement(By.xpath(NERLConstants.To_RP_ID)).sendKeys(To_RP_ID);
		Thread.sleep(2000);
		// Beneficiary ID to To Beneficiary ID
		
		driver.findElement(By.xpath(NERLConstants.To_Beneficiary_Id)).sendKeys(To_Benf);
		Thread.sleep(2000);
		driver.findElement(By.xpath("//*[@id='content']/div/data/div/div[3]/div/div[5]/div[2]/input")).click();
		Thread.sleep(2000);
		driver.findElement(By.xpath(NERLConstants.EWR_Type_Span)).click();
		Thread.sleep(2000);
		//Type of ENWR
		driver.findElement(By.xpath(NERLConstants.EWR_Type_Search)).sendKeys(ENWR_Type);
		// Select Searched Record From Dropdown
		Thread.sleep(2000);
		driver.findElement(By.xpath(NERLConstants.EWR_Type_Record)).click();
		// Click on Fetch Button
		driver.findElement(By.xpath(NERLConstants.Fetch_Button)).click();

		logger.info("Fetching Of Data On Benf To Benf Screen Succesfully");
		
		// Page Scroll upto 0,750
		utility.XY_PageScrollDown();
		Thread.sleep(2000);
        //Send ENWR number into Text box
		driver.findElement(By.xpath(NERLConstants.ENWR_number)).sendKeys(ENWR_Number);
		Thread.sleep(2000);
		driver.findElement(By.xpath(NERLConstants.Select_CheckBox)).click();
		Thread.sleep(2000);
		driver.findElement(By.xpath(NERLConstants.Select_Button)).click();
		Thread.sleep(3000);

		
		String Actual_Validation = driver.findElement(By.cssSelector(NERLConstants.EWR_ADD_Validation_message_css)).getText();
				
		//String Actual_Validation = driver.findElement(By.xpath(NERLConstants.EWR_Add_Validation_Message)).getText();
		Assert.assertEquals(Actual_Validation,
				"EWR added successfully for beneficiary transfer.",
				"Please Select Valid EWR");

		// Page Scroll upto 0,750
		utility.XY_PageScrollDown();

		// Get Text from Available qnt
		String Available_Quantity = driver.findElement(
				By.xpath(NERLConstants.Available_Qnt_Gettext)).getText();
		System.out.println("Available Quantity For Selected ENWR is :"
				+ Available_Quantity);

		/*Available_Quantity = Available_Quantity.replace(",", "");
		Double Trans_qnt = Double.parseDouble(Available_Quantity);
		Double Trans_qnt1 = Trans_qnt / 2;
		System.out.println("Transfered qntity" + Trans_qnt1);
		String Trans_qnt2 = String.valueOf(Trans_qnt1);*/
		Thread.sleep(2000);

		utility.DoubleClick(NERLConstants.Transfer_Quantity);
		
		// Thread.sleep(2000);
		driver.findElement(By.xpath(NERLConstants.Trans_Qnt_Doubleclick))
				.sendKeys("200");

		// Click on Add Button
		driver.findElement(By.xpath(NERLConstants.ADD_Button)).click();

		utility.XY_PageScrollUp();

		Thread.sleep(3000);
		String Actual_Validation_ADD = driver.findElement(
				By.xpath(NERLConstants.Add_Validation_Message)).getText();
		Assert.assertEquals(Actual_Validation_ADD,
				"Beneficiary To Beneficiary Transfer Saved Successfully.");
		
		// Capture EOT Transection number
		String EOT_no = driver
				.findElement(
						By.xpath("//*[@id='content']/div/data/div/div[2]/div[2]/div/table/tbody/tr/td[1]"))
				.getText();

		System.out.println(EOT_no);
		String string = EOT_no;
		String[] parts = string.split(":-      ");
		String part1 = parts[0];
		this.part2 = parts[1];
		System.out.println(part1);
		System.out.println("ENWR number is : " + part2);

		Thread.sleep(2000);
		// Click on Submit Button
		//utility.pageScrollDown(NERLConstants.Submit_Button);
		driver.findElement(By.xpath(NERLConstants.Submit_Button)).click();
		Thread.sleep(2000);
		utility.CaptureScreenshot(driver, "Benf_To_Benf_Same_Org_Submit",Record_no);
		Thread.sleep(2000);
		
		utility.logout();
		
   //++++++++++++++++++++++++EOT Approve by RP Checker (Seller Client)++++++++++++++++++++++++++++++++++++++++++++++++++	
		 utility.Login(User_ID_2,Passw_2);
		   // Click on pending txn button
	  		utility.PendingTxn_Approval(part2,NERLConstants.Approve_Button);
	   		Thread.sleep(2000);
	  		utility.CaptureScreenshot(driver, "B2B_Approve_RPSellerchecker",Record_no);
	  		utility.logout();
	  		
  //++++++++++++++++++++++++EOT Approve by RP Checker (Buyer Client)++++++++++++++++++++++++++++++++++++++++++++++++++	  		
	  		utility.Login(User_ID_3,Passw_3);
	 	   // Click on pending txn button
	   		utility.PendingTxn_Approval(part2,NERLConstants.Approve_Button);
	   		Thread.sleep(2000);
	   		utility.CaptureScreenshot(driver, "B2B_Approve_RPBuyerchecker",Record_no);
	   		utility.logout(); 		
	   		driver.close();
	  			
		}
	
   
   
 @DataProvider(name="Benf_To_Benf_Data")
	public Object[][] Ben_passdata() throws IOException{
		System.out.println("Inside Ben_passdata()");
		//Exceldataconfig config1=new Exceldataconfig("C:/Users/gauravn/workspace/Test/TestData/TestData.xlsx",1);
		config=new Exceldataconfig();
		config.setExcelPath("D:/TestData.xlsx");
		//config.setExcelPath("C:/Users/gauravn/workspace/Test/TestData/TestData.xlsx");
		config.setSheetId(1);
		int rows=config.getrowcount(1);
		Object[][] data=new Object[rows-1][14];
		for(int i=1; i< rows;i++){
			data[i-1][0]=config.getdata(1, i, 0 );   //Warehouse Code
			data[i-1][1]=config.getdata(1, i, 1 );   //Commodity ID
			data[i-1][2]=config.getdata(1, i, 2 );   //From Beneficiary Id
			data[i-1][3]=config.getdata(1, i, 3 );   //To RP ID
			data[i-1][4]=config.getdata(1, i, 4 );   //To Beneficiary
			data[i-1][5]=config.getdata(1, i, 5 );   //ENWR Type
			data[i-1][6]=config.getdata(1, i, 6 );   //Enwr Number
			
			data[i-1][7]=config.getdata(1, i, 7 );  //User ID RP maker
			data[i-1][8]=config.getdata(1, i, 8 );  //Password RP maker
			data[i-1][9]=config.getdata(1, i, 9 );  //User ID RP checker Seler Client
			data[i-1][10]=config.getdata(1, i, 10 );//Password RP Checker
			data[i-1][11]=config.getdata(1, i, 11 );//User Id RP Checker Buyer Client
			data[i-1][12]=config.getdata(1, i, 12 );//Password RP Checker
			data[i-1][13]=i;
			
			System.out.println(data[i-1][0]+" - "+ data[i-1][1]+" - "+ data[i-1][2]+" - "+ data[i-1][3]+" - "+ data[i-1][4]+" - "+ data[i-1][5]+" - "+ data[i-1][6]+" - "+ data[i-1][7]+" - "+ data[i-1][8]+" - "+ data[i-1][9]+" - "+ data[i-1][10]+" - "+ data[i-1][11]+" - "+ data[i-1][12]);
		}
		return data;
	}
}