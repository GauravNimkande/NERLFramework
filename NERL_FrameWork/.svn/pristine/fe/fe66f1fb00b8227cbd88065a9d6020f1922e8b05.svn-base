package withdrawal_pkg;
import java.io.IOException;
import java.util.concurrent.TimeUnit;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.interactions.Actions;
import org.testng.Assert;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.DataProvider;
import org.testng.annotations.Test;

import NERL.Benf_To_Benf;
import NERL.NERLConstants;
import library.Exceldataconfig;
import library.Utility;
public class Updated_Pledgee_Red {
	public String part2;
	public String part4;
	public String part3;
	public String part5;
	private static WebDriver driver;
	private Utility utility;
	public Exceldataconfig config;
	private final static Logger logger = LoggerFactory.getLogger(Updated_Pledgee_Red.class);
		@BeforeMethod
		public void Befour() throws InterruptedException 
		{
			System.out.println("Withdrawal Test Case Execution Started");
			
			System.setProperty("webdriver.chrome.driver", "D://chromedriver.exe");
		    Thread.sleep(2000);

			driver = new ChromeDriver();
			
			driver.get("https://nerltest.erepository.in/");
			 logger.info("New Driver Initiated");
		    driver.manage().window().maximize();
		    logger.info("URL Open");
		    utility=new Utility(driver);
		}
		//################ Test case 1####################################
		  @Test 
			(priority=1,description ="To verify initation/submit for pledgee Redeem transaction by Pledgee Maker",dataProvider="Withdrawal")
		 
			public void Pledgee_creation1(String Loan_account_no,String EPG_NO,String EWR_NO, String Redeem_qty,String RP_maker,String RP_PW,String User_role,String pledgee_M, String pledgee_pw,String Pledgee_checker,String Pledgee1_pw,int R_No) throws InterruptedException{
			  utility = new Utility(driver);	
		     System.out.println("Step 1 Submit by RP maker");   
		     System.out.println(User_role);
		     
		     if (User_role.equalsIgnoreCase("RP"))
		    {
		    	System.out.println("User Role is RP");
		       utility.RP_Maker(RP_maker, RP_PW);
		   	logger.info("RP maker Login");
		    	
		    }	
		    else
		    {
		    	System.out.println("User Role is Pledgee");
		    	utility.Pledgee_Maker(pledgee_M, pledgee_pw);
		    	logger.info("Pledgee maker Login");
		    }
		    	 
		     System.out.println("Initiation by Maker");

		     
		   utility.clickOnWebElement(Withdrawal_Cons.Loan_account_no_toggle,driver); // Loan account no toggle   		   		
		   		
	       driver.findElement(By.xpath(Withdrawal_Cons.Loan_account_details_list)).sendKeys(Loan_account_no);   	
	       
	       driver.findElement(By.xpath(Withdrawal_Cons.Loan_account_details_list1)).sendKeys(EPG_NO);
	       
	       utility.clickOnWebElement(Withdrawal_Cons.Checkbox_loan_account,driver);
	       Thread.sleep(2000);
	       utility.clickOnWebElement(Withdrawal_Cons.Fetch_redem,driver);  
	       
	       Thread.sleep(2000);   		   		
	       utility.scrolldown1(); 
	        
	       Thread.sleep(2000);
	       driver.findElement(By.xpath(Withdrawal_Cons.Enter_EWR)).sendKeys(EWR_NO);   //Enter EWR NO 	
	       
	       utility.clickOnWebElement(Withdrawal_Cons.Select_EWR,driver);   //Select checkbox4
	       
	       utility.clickOnWebElement(Withdrawal_Cons.Click_select_button,driver);
	       
	       Thread.sleep(2000);
	       
	       //Select ENWR--> Double Click on Redeem qnt
	       utility.DoubleClick("html/body/section/section/div/data/div/div[5]/div/div[1]/div/div[2]/div[1]/div/div[2]/div[3]/div[2]/div/div/div/div[4]/div");
	       
	       //Send Values in Redeem qnt
	       //driver.findElement(By.xpath("html/body/section/section/div/data/div/div[5]/div/div[1]/div/div[2]/div[1]/div/div[2]/div[3]/div[2]/div/div/div/div[4]/div[2]/form/input")).sendKeys("200");
	       driver.findElement(By.xpath(Withdrawal_Cons.sendkey1)).sendKeys(Redeem_qty);
	       //driver.findElement(By.xpath("html/body/section/section/div/data/div/div[5]/div/div[1]/div/div[2]/div[1]/div/div[2]/div[3]/div[2]/div/div/div/div[4]/div[2]/form/input")).sendKeys(Keys.TAB);
	       driver.findElement(By.xpath(Withdrawal_Cons.sendkey1)).sendKeys(Keys.TAB);
	       
	 		utility.scrolldown1(); 
	      
	 		 Thread.sleep(2000);     
	        
	        utility.clickOnWebElement(Withdrawal_Cons.Click_save,driver); 
	        
	        utility.XY_PageScrollUp();
	        
	         Thread.sleep(2000);
	 //****************** Validation message **********************
	          
	        String validation_message_save = driver.findElement(By.cssSelector(Withdrawal_Cons.validation_message_save)).getText();       
	          
	         System.out.println("Actual validation message is " +validation_message_save);
	         
	         Assert.assertEquals(validation_message_save,"Saved Successfully.");
	         
	         utility.scrolldown1();
	         utility.clickOnWebElement(Withdrawal_Cons.Submit_Redeem,driver);
	         Thread.sleep(3000);
	    //##############################################################
	             
	    		String Redeem_Number =driver.findElement(By.xpath(Withdrawal_Cons.Redeem_no_capture)).getText();
	    						
	    	    String string = Redeem_Number; 	
	    	    
	    	    String[] parts = string.split(":-      ");
	    			     
	    	    this.part2 = parts[1]; 		
	    	    System.out.println("2");	     
	    		System.out.println("EPR NO is : " +part2);
	    		
	    		Thread.sleep(3000);
	    		
	   //****************** Validation message **********************
	            
	         String validation_message_Submit = driver.findElement(By.cssSelector(Withdrawal_Cons.validation_message_Submit)).getText();
	           
	           System.out.println("Actual validation message is " +validation_message_Submit);
	           
	           Assert.assertEquals(validation_message_Submit,"Pledge Redeem submitted Successfully"); 
	           
	           utility.logout1();
	          
		  }
		  //############################## Test Case 2 Approved by Pledgee checker #################   
		  
	           @Test 
				(priority=2,description ="To verify initation/submit for pledgee Redeem transaction by Pledgee Maker",dataProvider="Withdrawal")
			 
				public void Pledgee_Approved(String Loan_account_no,String EPG_NO,String EWR_NO, String Redeem_qty,String RP_maker,String RP_PW,String User_role,String pledgee_M, String pledgee_pw,String Pledgee_checker,String Pledgee1_pw,int R_No) throws InterruptedException{
	    		System.out.println("Step 2 Approved by checker");
	    		
	    		utility.Login1(Pledgee_checker, Pledgee1_pw);
	    		   // Click on pending txn button
	    	  		utility.PendingTxn_Approval(part2,Withdrawal_Cons.Approve_redeem);
	    	  		Thread.sleep(2000);
	    	  		utility.logout();
	    	  		
	    }
	          
	     	 /* //############################## Test Case 3 Save and discard by Maker  #################   
	    	  @Test 
	     			(priority=3,description ="To verify if Pledgee Maker is able to Discard pledgee redeem transaction by Pledgee Maker",dataProvider="Withdrawal")
	     			
	     			public void Pledgee_Discard_maker(String Loan_account_no,String EPG_NO,String EWR_NO, String Redeem_qty,String RP_maker,String RP_PW,String User_role,String pledgee_M, String pledgee_pw,String Pledgee_checker,String Pledgee1_pw,int R_No) throws InterruptedException{
	     		    	
	     		     System.out.println("Step 3 Save than Discard by RP Maker");   
	     		    // System.out.println(User_role);
	     		     
	     		     if (User_role.equalsIgnoreCase("RP"))
	     		    {
	     		    	System.out.println("User Role is RP");
	     		       utility.RP_Maker(RP_maker, RP_PW);
	     		    	
	     		    	
	     		    }
	     		    else
	     		    {
	     		    	System.out.println("User Role is Pledgee");
	     		    	utility.Pledgee_Maker(pledgee_M, pledgee_pw);
	     		    	
	     		    }
	     		    	 
	     		     //System.out.println("Initiation by Maker-2");
	     		     
	     		    utility.clickOnWebElement(Withdrawal_Cons.Loan_account_no_toggle,driver); // Loan account no toggle   		   		
	    	   		
	     	         driver.findElement(By.xpath(Withdrawal_Cons.Loan_account_details_list)).sendKeys(Loan_account_no);   	
	     	         
	     	         driver.findElement(By.xpath(Withdrawal_Cons.Loan_account_details_list1)).sendKeys(EPG_NO);
	     	         
	     	         utility.clickOnWebElement(Withdrawal_Cons.Checkbox_loan_account,driver);
	     	         Thread.sleep(2000);
	     	         utility.clickOnWebElement(Withdrawal_Cons.Fetch_redem,driver);  
	     	         
	     	         Thread.sleep(2000);   		   		
	     	         utility.scrolldown1(); 
	     	          
	     	         Thread.sleep(2000);
	     	         driver.findElement(By.xpath(Withdrawal_Cons.Enter_EWR)).sendKeys(EWR_NO);   //Enter EWR NO 	
	     	         
	     	         utility.clickOnWebElement(Withdrawal_Cons.Select_EWR,driver);   //Select checkbox4
	     	         
	     	        utility.clickOnWebElement(Withdrawal_Cons.Click_select_button,driver);
	     	       
	     	       Thread.sleep(2000);
	     	       
	     	       //Select ENWR--> Double Click on Redeem qnt
	     	       utility.DoubleClick("html/body/section/section/div/data/div/div[5]/div/div[1]/div/div[2]/div[1]/div/div[2]/div[3]/div[2]/div/div/div/div[4]/div");
	     	       
	     	       //Send Values in Redeem qnt
	     	       //driver.findElement(By.xpath("html/body/section/section/div/data/div/div[5]/div/div[1]/div/div[2]/div[1]/div/div[2]/div[3]/div[2]/div/div/div/div[4]/div[2]/form/input")).sendKeys("200");
	     	       driver.findElement(By.xpath(Withdrawal_Cons.sendkey1)).sendKeys(Redeem_qty);
	     	       //driver.findElement(By.xpath("html/body/section/section/div/data/div/div[5]/div/div[1]/div/div[2]/div[1]/div/div[2]/div[3]/div[2]/div/div/div/div[4]/div[2]/form/input")).sendKeys(Keys.TAB);
	     	       driver.findElement(By.xpath(Withdrawal_Cons.sendkey1)).sendKeys(Keys.TAB);
	     	       
	     	 		utility.scrolldown1(); 
	     	      
	     	 		 Thread.sleep(2000);     
	     	 //**************************************************************************	  
	     	        utility.clickOnWebElement(Withdrawal_Cons.Click_save,driver); 
	     	        
	     	        utility.XY_PageScrollUp();
	     	        
	     	         Thread.sleep(2000);
	     	     // ****************************Validation Message ****************
	     			  
	     			 String Save_Validation1 = driver.findElement(By.cssSelector(Withdrawal_Cons.Validation_message_Approval)).getText();
	     			 
	     			 Assert.assertEquals(Save_Validation1,"Saved Successfully.");
	     			 
	     			 Thread.sleep(2000);
	     			 
	     			 utility.clickOnWebElement(Withdrawal_Cons.Discard_redeem,driver); 
	     					 
	     			 Thread.sleep(2000);
	     			 	 
	     	//*******************************Validation Messsage*************
	     			 String actual_result_remark= driver.findElement(By.xpath(Withdrawal_Cons.Remark_message)).getText();
	     			 
	     			 Thread.sleep(2000);  
	     			 
	     			 System.out.println("Actual validation message is " +actual_result_remark);
	     				      
	     			 Assert.assertEquals(actual_result_remark,"Please enter remark");
	     			//Thread.sleep(2000);  
	     			 driver.findElement(By.xpath(Withdrawal_Cons.Remark_textfield1)).sendKeys("enter remark"); //Enter remark
	     				
	     			 driver.findElement(By.xpath(Withdrawal_Cons.Discard_redeem)).click(); //Now again  click on discard button 
	     			 
	     			 utility.CaptureScreenshot(driver, "Discard by maker", R_No);
	     			 
	     			 utility.logout1();
	     			  	      
	     			 Thread.sleep(2000);
	     			  	      
	     			 driver.close();
	     			 Thread.sleep(2000);
	     		  }   */ 
	    	//############################## Test Case 4 Resubmit and Reject by Checker  #################   
	     		 @Test 
	     		(priority=3,description ="To verify if Pledgee checker is able to Reject Pledgee redeem",dataProvider="Withdrawal")
	     		
	     		public void Redeem_resubmit_by_checker(String Loan_account_no,String EPG_NO,String EWR_NO, String Redeem_qty,String RP_maker,String RP_PW,String User_role,String pledgee_M, String pledgee_pw,String Pledgee_checker,String Pledgee1_pw,int R_No) throws InterruptedException{
	     			 
	     			utility.Login1(Pledgee_checker, Pledgee1_pw);
	     		 
	     		// Click on pending txn button
	    	  		utility.PendingTxn_Rejection(part2,Withdrawal_Cons.Redeem_Reject_button);
	    	  		Thread.sleep(3000);
	    	  		utility.logout();
	    	  		
	    	  	//----------------------RP Maker Resubmit-------------------------------------		
	    	  		utility.RP_Maker(RP_maker, RP_PW);
	    			   // Click on pending txn button
	    		  		utility.Rejected_Submit(part2,Withdrawal_Cons.Submit_Redeem);
	    		  		Thread.sleep(3000);
	    		  		utility.logout();
	     		 }
	    	  	

	 	  	
	     		  
@DataProvider(name="Withdrawal")
	    	   public Object[][] passdata1() throws IOException{
	    		   
	    	    System.out.println("Inside passdata()");
	    	  
	    	    config=new Exceldataconfig();

	    	    config.setExcelPath("D:/TestData.xlsx");
	    	    //config.setExcelPath("D:/D DRIVE/New folder/Workspace/Withdrawal/TestData/TestData.xlsx");

	    	    config.setSheetId(5);
	    		
	    	    int rows=config.getrowcount(5);
	    	  
	    	    Object[][] data=new Object[rows-1][12];
	    	  
	    	    for(int i=1; i< rows;i++){
	    			
	    			data[i-1][0]=config.getdata(5, i, 0);    //Loan Account Number
	    			data[i-1][1]=config.getdata(5, i, 1);     //epg no
	    			data[i-1][2]=config.getdata(5, i, 2 );   //EWR NO
	    			data[i-1][3]=config.getdata(5, i, 3 );   //Invoke unit no
	    			data[i-1][4]=config.getdata(5, i, 4 );	  //Maker login
	    			data[i-1][5]=config.getdata(5, i, 5 );    //maker pw
	    			data[i-1][6]=config.getdata(5, i, 6 );    //user role
	    			data[i-1][7]=config.getdata(5, i, 7 );    //pledgee_maker
	    			data[i-1][8]=config.getdata(5, i, 8 );    // pledgee pw
	    			data[i-1][9]=config.getdata(5, i,9 );    //pledgee checker
	    			data[i-1][10]=config.getdata(5, i,10 );    // pledgee pw
	    			data[i-1][11]=i;                           //Record no
	    			
	    	 System.out.println(data[i-1][0]+" - " +data[i-1][1]+" - "+data[i-1][2]+" - " +data[i-1][3]+" - " +data[i-1][4]+" - " +data[i-1][5]+" - " +data[i-1][6]+" - " +data[i-1][7]+" - " +data[i-1][8]+" -  "+data[i-1][9]+" -  "+data[i-1][10]+" -  "+data[i-1][11]);
	    			
	    	}
	    		
	    	 System.out.println("data length:- "+data.length);

	    	return data;                        
	    	}

	    }

	           
	           
	           
	           
	           
	           
	           
	           
